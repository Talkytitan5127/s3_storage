# –ó–∞–¥–∞—á–∞ 2: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –¥–ª—è S3-–ø–æ–¥–æ–±–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 1

‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:**
- Consistent Hashing Algorithm (10 —Ç–µ—Å—Ç–æ–≤, 95% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- Chunking Logic (11 —Ç–µ—Å—Ç–æ–≤, 90% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–æ–≥—Ä–µ—Å—Å:** 2/10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ (20%)

---

## –¶–µ–ª–∏ Task 2

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è, —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏–≤—à–∏—Å—å –Ω–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è P0 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö) –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –∏ –Ω–∞—á–∞—Ç—å P1 (–≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ) —Ç–µ—Å—Ç—ã.

---

## –†–∞–∑–¥–µ–ª 1: P0 Unit —Ç–µ—Å—Ç—ã (–ö—Ä–∏—Ç–∏—á–Ω–æ - –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑)

### 1.1 Database Operations (PostgreSQL)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team  
**–°—Ä–æ–∫:** 3 –¥–Ω—è  
**–§–∞–π–ª:** `internal/storage/postgres_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ P0 - –ö–†–ò–¢–ò–ß–ù–û

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**Setup:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å testcontainers-go –¥–ª—è –ø–æ–¥–Ω—è—Ç–∏—è PostgreSQL –≤ Docker

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (15 —Ç–µ—Å—Ç–æ–≤):**

1. **TestCreateFile_Success**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `files`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: file_id —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω (UUID)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: upload_status = 'pending'

2. **TestCreateFile_DuplicateID**
   - –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º file_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ unique constraint violation
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è

3. **TestCreateChunks_Batch**
   - –°–æ–∑–¥–∞–Ω–∏–µ 6 chunks –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch insert
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 6 –∑–∞–ø–∏—Å–µ–π —Å–æ–∑–¥–∞–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: foreign key –Ω–∞ file_id –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

4. **TestGetFile_ByID**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ file_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ –ø–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–≤—è–∑–∞–Ω–Ω—ã–µ chunks –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (JOIN)

5. **TestGetFile_NotFound**
   - –ó–∞–ø—Ä–æ—Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ file_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ErrNotFound

6. **TestUpdateFileStatus**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ upload_status: pending ‚Üí uploading ‚Üí completed
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: updated_at timestamp –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

7. **TestGetChunksByFileID**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö chunks –¥–ª—è —Ñ–∞–π–ª–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 6 chunks
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ chunk_number

8. **TestTransaction_Rollback**
   - –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∏ chunks
   - –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: rollback –æ—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

9. **TestTransaction_Commit**
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ + chunks –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: commit —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

10. **TestStorageServerRegistration**
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ storage —Å–µ—Ä–≤–µ—Ä–∞
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: –∑–∞–ø–∏—Å—å –≤ `storage_servers`
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: 150 –∑–∞–ø–∏—Å–µ–π –≤ `hash_ring_nodes`

11. **TestStorageServerHeartbeat**
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_heartbeat
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: timestamp –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

12. **TestGetActiveStorageServers**
    - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—ã —Å last_heartbeat < 30 —Å–µ–∫—É–Ω–¥

13. **TestUploadSession_Create**
    - –°–æ–∑–¥–∞–Ω–∏–µ upload session
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: session_id —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: expires_at = now + 1 hour

14. **TestUploadSession_Cleanup**
    - –°–æ–∑–¥–∞—Ç—å expired session
    - –í—ã–∑–≤–∞—Ç—å cleanup job
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: expired sessions —É–¥–∞–ª–µ–Ω—ã

15. **TestConcurrentWrites**
    - 10 goroutines –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—é—Ç —Ñ–∞–π–ª—ã
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ—Ç deadlocks
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 10 —Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è testcontainers –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- ‚úÖ Code coverage ‚â• 85%
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å `-race` —Ñ–ª–∞–≥–æ–º

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã:**
- `internal/storage/postgres.go` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `internal/storage/postgres_test.go` - —Ç–µ—Å—Ç—ã
- `migrations/001_initial_schema.sql` - SQL —Å—Ö–µ–º–∞

---

## –†–∞–∑–¥–µ–ª 2: P0 Integration —Ç–µ—Å—Ç—ã

### 2.1 End-to-End Upload/Download Flow

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** QA + Backend Team  
**–°—Ä–æ–∫:** 4 –¥–Ω—è  
**–§–∞–π–ª:** `tests/integration/e2e_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ P0 - –ö–†–ò–¢–ò–ß–ù–û

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**Setup:** Docker Compose —Å PostgreSQL + API Gateway + 6 Storage Servers

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (10 —Ç–µ—Å—Ç–æ–≤):**

1. **TestUploadDownload_SmallFile**
   - Upload —Ñ–∞–π–ª–∞ 10 MB
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: 201 Created, file_id –≤–æ–∑–≤—Ä–∞—â–µ–Ω
   - Download —Ñ–∞–π–ª–∞ –ø–æ file_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—É

2. **TestUploadDownload_LargeFile**
   - Upload —Ñ–∞–π–ª–∞ 5 GB
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–∞–π–ª —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 6 chunks
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: chunks —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º storage —Å–µ—Ä–≤–µ—Ä–∞–º
   - Download –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

3. **TestUploadDownload_MaxSize**
   - Upload —Ñ–∞–π–ª–∞ 10 GB (–º–∞–∫—Å–∏–º—É–º)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —É—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
   - Download –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

4. **TestUpload_ExceedsMaxSize**
   - –ü–æ–ø—ã—Ç–∫–∞ upload —Ñ–∞–π–ª–∞ 11 GB
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 413 Payload Too Large

5. **TestUpload_InvalidContentType**
   - Upload –±–µ–∑ Content-Type header
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 400 Bad Request

6. **TestDownload_NonExistentFile**
   - GET /files/{invalid-uuid}
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 404 Not Found

7. **TestListFiles**
   - Upload 10 —Ñ–∞–π–ª–æ–≤
   - GET /files (list endpoint)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 10 —Ñ–∞–π–ª–æ–≤ –≤ —Å–ø–∏—Å–∫–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: pagination —Ä–∞–±–æ—Ç–∞–µ—Ç

8. **TestDeleteFile**
   - Upload —Ñ–∞–π–ª–∞
   - DELETE /files/{file_id}
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: chunks —É–¥–∞–ª–µ–Ω—ã —Å storage —Å–µ—Ä–≤–µ—Ä–æ–≤

9. **TestGetFileMetadata**
   - Upload —Ñ–∞–π–ª–∞
   - GET /files/{file_id}/metadata
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤—Å–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

10. **TestUploadProgress**
    - Upload –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞
    - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è pending ‚Üí uploading ‚Üí completed

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ Docker Compose –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- ‚úÖ –¢–µ—Å—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã (cleanup –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ)
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è < 10 –º–∏–Ω—É—Ç

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã:**
- `tests/integration/e2e_test.go` - —Ç–µ—Å—Ç—ã
- `tests/integration/docker-compose.test.yml` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `cmd/api-gateway/main.go` - API Gateway
- `cmd/storage-server/main.go` - Storage Server

---

## –†–∞–∑–¥–µ–ª 3: P1 Unit —Ç–µ—Å—Ç—ã (–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 3.1 gRPC Handlers

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team  
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–§–∞–π–ª:** `internal/grpc/handlers_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (10 —Ç–µ—Å—Ç–æ–≤):**

1. **TestPutChunk_Success**
   - Mock gRPC stream
   - –û—Ç–ø—Ä–∞–≤–∫–∞ chunk –¥–∞–Ω–Ω—ã—Ö (1 GB)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: chunk —Å–æ—Ö—Ä–∞–Ω–µ–Ω –Ω–∞ –¥–∏—Å–∫

2. **TestPutChunk_InvalidChunkID**
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º chunk_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è gRPC error INVALID_ARGUMENT

3. **TestPutChunk_DiskFull**
   - –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –¥–∏—Å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è gRPC error RESOURCE_EXHAUSTED

4. **TestGetChunk_Success**
   - –ó–∞–ø—Ä–æ—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ chunk
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∏–º—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

5. **TestGetChunk_NotFound**
   - –ó–∞–ø—Ä–æ—Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ chunk_id
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è gRPC error NOT_FOUND

6. **TestGetChunk_CorruptedFile**
   - Chunk —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –Ω–∞ –¥–∏—Å–∫–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: checksum mismatch –æ–±–Ω–∞—Ä—É–∂–µ–Ω

7. **TestDeleteChunk_Success**
   - –£–¥–∞–ª–µ–Ω–∏–µ chunk —Å –¥–∏—Å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–∞–π–ª —É–¥–∞–ª–µ–Ω

8. **TestHealthCheck**
   - –í—ã–∑–æ–≤ HealthCheck RPC
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è SERVING status

9. **TestStreamingPerformance**
   - Benchmark –¥–ª—è streaming 1 GB chunk
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: throughput > 100 MB/s

10. **TestConcurrentStreams**
    - 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö PutChunk –≤—ã–∑–æ–≤–æ–≤
    - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏:**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Mock gRPC streams —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Code coverage ‚â• 80%

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã:**
- `internal/grpc/handlers.go` - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `internal/grpc/handlers_test.go` - —Ç–µ—Å—Ç—ã
- `api/proto/storage.proto` - protobuf –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

---

## –†–∞–∑–¥–µ–ª 4: P1 Integration —Ç–µ—Å—Ç—ã

### 4.1 Interrupted Upload Handling

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team  
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–§–∞–π–ª:** `tests/integration/interrupted_upload_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (5 —Ç–µ—Å—Ç–æ–≤):**

1. **TestInterruptedUpload_ClientDisconnect**
   - –ù–∞—á–∞—Ç—å upload
   - –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å disconnect –ø–æ—Å–ª–µ 3 chunks
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: cleanup job —É–¥–∞–ª–∏–ª —á–∞—Å—Ç–∏—á–Ω—ã–µ chunks

2. **TestInterruptedUpload_ServerCrash**
   - –ù–∞—á–∞—Ç—å upload
   - "–£–±–∏—Ç—å" storage —Å–µ—Ä–≤–µ—Ä –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏ chunk
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è

3. **TestInterruptedUpload_NetworkTimeout**
   - –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å network timeout
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: retry logic —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

4. **TestCleanupJob_ExpiredSessions**
   - –°–æ–∑–¥–∞—Ç—å 5 expired upload sessions
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å cleanup job
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 5 sessions —É–¥–∞–ª–µ–Ω—ã

5. **TestCleanupJob_ActiveSessions**
   - –°–æ–∑–¥–∞—Ç—å active upload session
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å cleanup job
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: active session –ù–ï —É–¥–∞–ª–µ–Ω–∞

### 4.2 Storage Server Management

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team  
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–§–∞–π–ª:** `tests/integration/storage_management_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (5 —Ç–µ—Å—Ç–æ–≤):**

1. **TestAddStorageServer_Dynamic**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å 6 —Å–µ—Ä–≤–µ—Ä–∞–º–∏
   - Upload 100 —Ñ–∞–π–ª–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å 7-–π storage —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç ~14% chunks

2. **TestRemoveStorageServer**
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–∏–Ω storage —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–µ—Ä–≤–µ—Ä –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ 'inactive'
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–æ–≤—ã–µ chunks –Ω–µ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –Ω–µ–≥–æ

3. **TestStorageServerFailover**
   - Upload —Ñ–∞–π–ª–∞
   - "–£–±–∏—Ç—å" storage —Å–µ—Ä–≤–µ—Ä —Å –æ–¥–Ω–∏–º –∏–∑ chunks
   - –ü–æ–ø—ã—Ç–∫–∞ download
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞

4. **TestHeartbeatMechanism**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å storage —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: heartbeat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
   - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å heartbeat
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ —Å–µ—Ä–≤–µ—Ä 'inactive'

5. **TestHashRingRefresh**
   - API Gateway –∫–µ—à–∏—Ä—É–µ—Ç hash ring
   - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π storage —Å–µ—Ä–≤–µ—Ä
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ API Gateway –æ–±–Ω–æ–≤–∏–ª ring

### 4.3 Concurrent Operations

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Backend Team  
**–°—Ä–æ–∫:** 2 –¥–Ω—è  
**–§–∞–π–ª:** `tests/integration/concurrent_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (5 —Ç–µ—Å—Ç–æ–≤):**

1. **TestConcurrentUploads**
   - 50 goroutines –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç —Ñ–∞–π–ª—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ 50 —Ñ–∞–π–ª–æ–≤ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

2. **TestConcurrentDownloads**
   - Upload 10 —Ñ–∞–π–ª–æ–≤
   - 100 goroutines –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫–∞—á–∏–≤–∞—é—Ç –∏—Ö
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤—Å–µ downloads —É—Å–ø–µ—à–Ω—ã

3. **TestMixedOperations**
   - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: uploads, downloads, deletes, list
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π

4. **TestDatabaseConnectionPool**
   - 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: connection pool –Ω–µ –∏—Å—á–µ—Ä–ø—ã–≤–∞–µ—Ç—Å—è

5. **TestRaceConditions**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã —Å `-race` —Ñ–ª–∞–≥–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ—Ç race conditions –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ

---

## –†–∞–∑–¥–µ–ª 5: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ CI/CD

### 5.1 Docker Compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª:** `docker-compose.test.yml`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- PostgreSQL 15 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- API Gateway –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- 6 Storage Server –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è
- Volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- Health checks

### 5.2 GitHub Actions CI/CD

**–§–∞–π–ª:** `.github/workflows/test.yml`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° P1

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ó–∞–ø—É—Å–∫ –Ω–∞ –∫–∞–∂–¥—ã–π PR
- –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤
- –ó–∞–ø—É—Å–∫ integration —Ç–µ—Å—Ç–æ–≤
- Race detection
- Coverage reporting
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ merge –ø—Ä–∏ failing tests

---

## –†–∞–∑–¥–µ–ª 6: P2 —Ç–µ—Å—Ç—ã (–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 6.1 Error Handling & Edge Cases

**–§–∞–π–ª:** `tests/integration/error_handling_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ P2

**–¢–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤):**
1. TestDatabaseConnectionLoss
2. TestStorageServerConnectionLoss
3. TestDiskFullOnStorageServer
4. TestCorruptedChunkDetection
5. TestInvalidInputValidation

### 6.2 Monitoring & Health Checks

**–§–∞–π–ª:** `tests/integration/monitoring_test.go`  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ P2

**–¢–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤):**
1. TestHealthEndpoint
2. TestMetricsEndpoint
3. TestStorageServerHealth
4. TestDatabaseHealth
5. TestAlerting

### 6.3 Load Testing

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:** k6 –∏–ª–∏ Locust  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ P2

**–°—Ü–µ–Ω–∞—Ä–∏–∏ (5 —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤):**
1. LoadTest_SustainedUpload (100 concurrent users, 10 min)
2. LoadTest_SustainedDownload (200 concurrent users, 10 min)
3. LoadTest_MixedWorkload (150 concurrent users, 15 min)
4. LoadTest_SpikeTest (10 ‚Üí 200 users —Ä–µ–∑–∫–æ)
5. LoadTest_StressTest (–¥–æ failure point)

---

## –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 2

### –ù–µ–¥–µ–ª—è 1 (–î–Ω–∏ 1-3): P0 Database Operations
- [ ] –î–µ–Ω—å 1: Setup testcontainers, —Å–æ–∑–¥–∞—Ç—å SQL —Å—Ö–µ–º—É
- [ ] –î–µ–Ω—å 2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 8 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–µ–Ω—å 3: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 7 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –¥–æ—Å—Ç–∏—á—å 85% coverage

### –ù–µ–¥–µ–ª—è 1 (–î–Ω–∏ 4-7): P0 E2E Integration
- [ ] –î–µ–Ω—å 4: Setup Docker Compose, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API Gateway
- [ ] –î–µ–Ω—å 5: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Storage Server, 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–µ–Ω—å 6: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 5 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- [ ] –î–µ–Ω—å 7: –û—Ç–ª–∞–¥–∫–∞, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ù–µ–¥–µ–ª—è 2 (–î–Ω–∏ 8-10): P1 gRPC Handlers
- [ ] –î–µ–Ω—å 8: –°–æ–∑–¥–∞—Ç—å protobuf –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å handlers
- [ ] –î–µ–Ω—å 9: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 10 —Ç–µ—Å—Ç–æ–≤
- [ ] –î–µ–Ω—å 10: Benchmarks, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ù–µ–¥–µ–ª—è 2 (–î–Ω–∏ 11-14): P1 Integration —Ç–µ—Å—Ç—ã
- [ ] –î–µ–Ω—å 11: Interrupted Upload —Ç–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤)
- [ ] –î–µ–Ω—å 12: Storage Management —Ç–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤)
- [ ] –î–µ–Ω—å 13: Concurrent Operations —Ç–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤)
- [ ] –î–µ–Ω—å 14: CI/CD setup, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ù–µ–¥–µ–ª—è 3: P2 —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –î–Ω–∏ 15-16: Error Handling —Ç–µ—Å—Ç—ã
- [ ] –î–Ω–∏ 17-18: Monitoring —Ç–µ—Å—Ç—ã
- [ ] –î–Ω–∏ 19-21: Load Testing

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Task 2

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ (Must Have):
- ‚úÖ –í—Å–µ P0 —Ç–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç (25 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –í—Å–µ P1 —Ç–µ—Å—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç (25 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ Code coverage ‚â• 80% –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ù–µ—Ç race conditions
- ‚úÖ Docker Compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ CI/CD pipeline –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Should Have):
- ‚úÖ P2 Error Handling —Ç–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ P2 Monitoring —Ç–µ—Å—Ç—ã (5 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (Nice to Have):
- ‚úÖ Load Testing —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ Performance benchmarks
- ‚úÖ Code coverage ‚â• 90%

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Task 2:**
- –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: 70-80% (7-8/10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–∞–±–æ—Ä–æ–≤)
- –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 71+ (21 –∏–∑ Task 1 + 50 –∏–∑ Task 2)
- Code coverage: ‚â• 80%
- –í—Å–µ P0 –∏ P1 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production deployment

---

## –†–µ—Å—É—Ä—Å—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- testcontainers-go –¥–ª—è PostgreSQL
- Docker Compose –¥–ª—è integration —Ç–µ—Å—Ç–æ–≤
- gRPC –∏ protobuf
- GitHub Actions –¥–ª—è CI/CD
- k6 –∏–ª–∏ Locust –¥–ª—è load testing

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [testcontainers-go](https://golang.testcontainers.org/)
- [gRPC Go Tutorial](https://grpc.io/docs/languages/go/)
- [Docker Compose](https://docs.docker.com/compose/)
- [GitHub Actions](https://docs.github.com/en/actions)

---

**–°–æ–∑–¥–∞–Ω–æ:** 2026-01-06  
**–ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞:** Task 1 (–∑–∞–≤–µ—Ä—à–µ–Ω –Ω–∞ 20%)  
**–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2-3 –Ω–µ–¥–µ–ª–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (–±–ª–æ–∫–∏—Ä—É–µ—Ç production release)